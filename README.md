# MonoRepo for Darlean

This is the monorepo for Darlean that contains basic npm packages, suite packages and example code.

## Monorepo contents

### Basic Packages
The following basic packages are part of this monorepo:
* [@darlean/base](base) with declarations and basic types needed to write (implement) actors ([api-doc](https://docs.darlean.io/latest/@darlean_base.html))
* [@darlean/core](core) with the core framework needed for hosting (running) actors ([api-doc](https://docs.darlean.io/latest/@darlean_core.html))
* [@darlean/utils](utils) with all kind of utilities that do not directly relate to virtual actors ([api-doc](https://docs.darlean.io/latest/@darlean_utils.html))
* [@darlean/docgen](docgen) with a preprocessor for [typedoc](https://www.npmjs.com/package/typedoc) to generate the [documentation](https://docs.darlean.io/latest) the way we like it

### Suite packages
The following actor suite packages are part of this monorepo:
* [@darlean/actor-lock-suite](suites/actor-lock-suite) which contains the implementation of the distributed actor lock. The distributed actor lock
  ensures that no more than 1 actor of the same type and id are active at the same moment in the cluster. ([api-doc](https://docs.darlean.io/latest/@darlean_actor-lock-suite.html))
* [@darlean/actor-registry-suite](suites/actor-registry-suite) which contains the implementation of the distributed actor registry. The distributed
  actor registry provides applications in the cluster with information about which actor types run on which applications, and how they should be invoked. ([api-doc](https://docs.darlean.io/latest/@darlean_actor-registry-suite.html))
* [@darlean/persistence-suite](suites/persistence-suite) which provides access to the individual persistence implementations. ([api-doc](https://docs.darlean.io/latest/@darlean_persistence-suite.html))
* [@darlean/fs-persistence-suite](suites/fs-persistence-suite) which provides high performing file-system based persistence. ([api-doc](https://docs.darlean.io/latest/@darlean_fs-persistence-suite.html))

### Examples
We have also included some working examples:
* [Tutorial of creating an distributed Oracle using Darlean](examples/src/oracle/1_the_basics)
* [Performance benchmark](examples/src/performance)

### Testing
We also have end-to-end (blackbox) tests:
* [End-to-end tests](tests)

## Building

Because we use a monorepo (with multiple packages in one git repo), there apply some special rules:
* All npm commands must be executed from the *root* of the monorepo using the `-w name` or `--workspaces` flags to instruct npm to operate on one specific workspace (`-w name`) or on all workspaces together (`--workspaces`).
* The `-w` and `--workspaces` flags can be combined with `--if-present` to ignore warnings when certain commands are not present for all workspaces
* The following workspace names are supported:
  * base
  * core
  * utils
  * docgen
  * examples
  * suites/actor-lock-suite
  * suites/actor-registry-suite
  * suites/persistence-suite
  * suites/fs-persistence-suite
* Every workspace has its own `package.json`, but there is only one `node_modules` and one `package-lock.json` at the root of the repo
* The `npm run install-workspaces` command automatically creates symlinks that allow all packages to see the most recent versions of all
  other packages, without the need for first committing the changes.

### Installing

To install everything after a fresh pull:
```
$ npm run install-workspaces
```

To install only one specific workspace:
```
$ npm install -w base
```

### Building

```
$ npm run build --workspaces
$ npm run build -w base
```

### Formatting, linting and building

Do this before every commit!

```
$ npm run precommit --workspaces
$ npm run precommit -w base
```

### Formatting, linting, installing and testing

Recommended before every commit!

```
$ npm run preversion --workspaces
$ npm run preversion -w base
```

### Unit testing and running the examples

```
$ npm run test --workspaces --if-present
$ npm run test -w base
```
## Documentation

Documentation can be regenerated by means of
```
$ npm run doc
```

Please ignore all the warnings, that still has to be fixed.

At regular times, the most recently generated documentation is uploaded to https://docs.darlean.io/latest/.